<!DOCTYPE html><html lang="ru"><head><meta charset="utf-8" /><meta name="author" content="Иван Пономарёв, КУРС/МФТИ" /><title>Core Java: Курс лекций. Лекция 5</title><meta content="yes" name="apple-mobile-web-app-capable" /><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport" /><link href="reveal.js-3.7.0/css/reveal.css" rel="stylesheet" /><link rel="stylesheet" href="white_course.css" id="theme" /><!--This CSS is generated by the Asciidoctor-Reveal.js converter to further integrate AsciiDoc's existing semantic with Reveal.js--><style type="text/css">.reveal div.right {
  float: right;
}

/* callouts */
.conum[data-value] {display:inline-block;color:#fff!important;background-color:rgba(50,150,50,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}</style><link rel="stylesheet" href="./font-awesome-4.7.0/css/font-awesome.css" /><style>/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}</style><link href="reveal.js-3.7.0/lib/css/zenburn.css" rel="stylesheet" /><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "reveal.js-3.7.0/css/print/pdf.css" : "reveal.js-3.7.0/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><!--[if lt IE 9]><script src="reveal.js-3.7.0/lib/js/html5shiv.js"></script><![endif]--></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Core Java</h1><h2>Курс лекций. Лекция 5</h2><div class="preamble"><div class="paragraph"><p><a href="mailto:ponomarev@corchestra.ru">ponomarev@corchestra.ru</a></p></div>
<div class="paragraph"><p><span class="icon"><i class="fa fa-twitter fa-lg"></i></span> @inponomarev</p></div></div><p class="author"><small>Иван Пономарёв, КУРС/МФТИ</small></p></section>
<section id="_регулярные_выражения"><h2>Регулярные выражения</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">String</span> input = <span class="string"><span class="delimiter">&quot;</span><span class="content">11:59 am</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Pattern</span> pattern =
  <span class="predefined-type">Pattern</span>.compile(<span class="string"><span class="delimiter">&quot;</span><span class="content">([1-9]|1[0-2])</span><span class="char">\\</span><span class="content">s*:</span><span class="char">\\</span><span class="content">s*([0-5][0-9])</span><span class="char">\\</span><span class="content">s*([ap]m)</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Matcher</span> matcher = pattern.matcher(input);

<span class="comment">//matches() требует совпадения всей строки,</span>
<span class="comment">//find() -- находит первое совпадение</span>
<span class="keyword">if</span> (matcher.matches()) {
    <span class="predefined-type">String</span> hours = matcher.group(<span class="integer">1</span>); <span class="comment">//11</span>
    <span class="predefined-type">String</span> minutes = matcher.group(<span class="integer">2</span>); <span class="comment">//59</span>
    <span class="predefined-type">String</span> period = matcher.group(<span class="integer">3</span>); <span class="comment">//am</span>
}</code></pre></section>
<section id="_поискзамена_в_цикле"><h2>Поиск/замена в цикле</h2><div class="paragraph"><p>Пример на <a href="https://stackoverflow.com/questions/9605716/java-regular-expression-find-and-replace">StackOverflow</a>: xотим получить на выходе "1xxxx23":</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; replacements = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;();

replacements.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">${env1}</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>);
replacements.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">${env2}</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>);
replacements.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">${env3}</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>);


<span class="predefined-type">String</span> line =<span class="string"><span class="delimiter">&quot;</span><span class="content">${env1}xxxx${env2}${env3}</span><span class="delimiter">&quot;</span></span>;</code></pre></section>
<section id="_поискзамена_в_цикле_2"><h2>Поиск/замена в цикле</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="comment">//Начиная с Java9, можно использовать StringBuilder</span>
<span class="predefined-type">StringBuffer</span> sb = <span class="keyword">new</span> <span class="predefined-type">StringBuffer</span>();

<span class="predefined-type">Pattern</span> p = <span class="predefined-type">Pattern</span>.compile(<span class="string"><span class="delimiter">&quot;</span><span class="content">(</span><span class="char">\\</span><span class="content">$</span><span class="char">\\</span><span class="content">{[^}]+</span><span class="char">\\</span><span class="content">})</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Matcher</span> m = p.matcher(line);
<span class="keyword">while</span> (m.find()) {
    <span class="predefined-type">String</span> repString = replacements.get(m.group(<span class="integer">1</span>));
    <span class="keyword">if</span> (repString != <span class="predefined-constant">null</span>)
        m.appendReplacement(sb, repString);
}
m.appendTail(sb);

<span class="predefined-type">System</span>.out.println(sb.toString()); <span class="comment">//1xxxx23</span></code></pre></section>
<section id="_регулярные_выражения_2"><h2>Регулярные выражения</h2><div class="ulist"><ul><li class="fragment"><p>Достоинства</p><div class="ulist"><ul><li><p>Проверяют формат строки</p></li><li><p>Гибкие к необязательным/незначащим разделителям, "мусору" и т. п.</p></li><li><p>Группы&#8201;&#8212;&#8201;мощнейший инструмент выделения данных из строки</p></li></ul></div></li><li class="fragment"><p>Цена, которую мы платим</p><div class="ulist"><ul><li><p>Нужно учиться пользоваться (написаны целые книги)</p></li><li><p>Нужно учиться грамотно пользоваться (есть возможность просадить производительность)</p></li><li><p>Выглядят уродливо и непонятно</p></li></ul></div></li></ul></div></section>
<section id="_конечные_автоматы"><h2>Конечные автоматы</h2><div class="paragraph"><p>Как разобрать строку вида?</p></div>
<pre class="CodeRay listingblock"><code>  Название,Товары и услуги
  ООО "Рога и Копыта","рога, копыта"
  "OOO ""Берёзка""",веники берёзовые</code></pre></section>
<section id="_конечный_автомат"><h2>Конечный автомат!</h2><div class="imageblock" style=""><img src="images/dfa.png.png" alt="dfa.png" /></div></section>
<section id="_реализация"><h2>Реализация</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="type">enum</span> State {START, QUOTED_BODY, QUOTE_READ, UNQUOTED_BODY}
<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; parse(<span class="predefined-type">String</span> line) {
    State state = State.START;
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; result = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
    <span class="predefined-type">StringBuilder</span> fieldValue = <span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>();
    <span class="keyword">for</span> (<span class="type">char</span> c : line.toCharArray()) {
        <span class="keyword">switch</span> (state) {
            <span class="keyword">case</span> START: . . .
            case QUOTED_BODY: . . .
            case QUOTE_READ: . . .
            case UNQUOTED_BODY: . . .
        }
    }
    result.add(fieldValue.toString());
    <span class="keyword">return</span> result;
}</code></pre></section>
<section id="_начали_читать_поле" data-transition="none"><h2>Начали читать поле</h2><div class="imageblock" style=""><img src="images/start.png.png" alt="start.png" /></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="keyword">case</span> START:
    fieldValue = <span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>();
    <span class="keyword">if</span> (c == <span class="string"><span class="delimiter">'</span><span class="content">&quot;</span><span class="delimiter">'</span></span>)
        state = State.QUOTED_BODY;
    <span class="keyword">else</span> {
        fieldValue.append(c);
        state = State.UNQUOTED_BODY;
    }
    <span class="keyword">break</span>;</code></pre></section>
<section id="_закавыченное_значение" data-transition="none"><h2>Закавыченное значение</h2><div class="imageblock" style=""><img src="images/quoted_body.png.png" alt="quoted body.png" /></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="keyword">case</span> QUOTED_BODY:
    <span class="keyword">if</span> (c == <span class="string"><span class="delimiter">'</span><span class="content">&quot;</span><span class="delimiter">'</span></span>)
        state = State.QUOTE_READ;
    <span class="keyword">else</span> {
        fieldValue.append(c);
        state = State.QUOTED_BODY;
    }
    <span class="keyword">break</span>;</code></pre></section>
<section id="_встретилась_кавычка" data-transition="none"><h2>Встретилась кавычка</h2><div class="imageblock" style=""><img src="images/quote_read.png.png" alt="quote read.png" /></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="keyword">case</span> QUOTE_READ:
    <span class="keyword">if</span> (c == <span class="string"><span class="delimiter">'</span><span class="content">&quot;</span><span class="delimiter">'</span></span>) {
        fieldValue.append(c);
        state = State.QUOTED_BODY;
    } <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string"><span class="delimiter">'</span><span class="content">,</span><span class="delimiter">'</span></span>) {
        result.add(fieldValue.toString());
        state = State.START;
    } <span class="keyword">else</span> { <span class="comment">//invalid input format</span>
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalStateException</span>();
    } <span class="keyword">break</span>;</code></pre></section>
<section id="_незакавыченное_значение" data-transition="none"><h2>Незакавыченное значение</h2><div class="imageblock" style=""><img src="images/unquoted_body.png.png" alt="unquoted body.png" /></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="keyword">case</span> UNQUOTED_BODY:
    <span class="keyword">if</span> (c == <span class="string"><span class="delimiter">'</span><span class="content">,</span><span class="delimiter">'</span></span>) {
        result.add(fieldValue.toString());
        state = State.START;
    } <span class="keyword">else</span> {
        fieldValue.append(c);
    }
    <span class="keyword">break</span>;</code></pre></section>
<section id="_в_завершение"><h2>В завершение</h2><div class="ulist"><ul><li><p>Математический факт: Каждый ДКА может быть сконвертирован в регулярное выражение, и наоборот.</p></li><li><p>При обработке строк регулярки и ДКА&#8201;&#8212;&#8201;наше всё.</p></li></ul></div></section>
<section id="_wrapper_types"><h2>Wrapper Types</h2><div class="paragraph"><p>Примитивные типы несовместимы с объектами. Поэтому есть Wrapper Classes:</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%" /><col style="width:50%" /></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><code>byte</code>, <code>short</code>, <code>int</code>, <code>long</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><code>Byte</code>, <code>Short</code>, <code>Integer</code>, <code>Long</code></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><code>char</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><code>Character</code></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><code>float</code>, <code>double</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><code>Float</code>, <code>Double</code></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><code>boolean</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><code>Boolean</code></p></div></div></td></tr></table></section>
<section id="_кэширование_object_pool"><h2>Кэширование (object pool)</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:35%" /><col style="width:65%" /></colgroup><tbody><tr><td class="tableblock halign-left valign-middle"><div><pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">Integer</span> five1 = <span class="predefined-type">Integer</span>.valueOf(<span class="integer">5</span>);
<span class="predefined-type">Integer</span> five2 = <span class="predefined-type">Integer</span>.valueOf(<span class="integer">5</span>);
<span class="comment">/* DO NOT DO THIS!!*/</span>
<span class="predefined-type">Integer</span> five3
  = <span class="keyword">new</span> <span class="predefined-type">Integer</span>(<span class="integer">5</span>);</code></pre></div></td><td class="tableblock halign-center valign-middle"><div><div class="imageblock" style=""><img src="images/ipool.png.png" alt="ipool.png" /></div></div></td></tr></table></section>
<section id="_wrapper_типы_похожи_на_строки"><h2>Wrapper-типы похожи на строки</h2><div class="ulist"><ul><li><p>Объекты иммутабельные. Если нужен новый&#8201;&#8212;&#8201;создаём новый.</p></li><li><p>Проверка равенства&#8201;&#8212;&#8201;только по <code>equals</code>!</p></li></ul></div></section>
<section id="_превращение_числа_из_строки_и_в_строку"><h2>Превращение числа из строки и в строку</h2><div class="paragraph"><p>Статические методы:</p></div>
<div class="ulist"><ul><li><p><code>Integer.parseInt(value, radix)</code></p></li><li><p><code>Integer.toString(value, radix)</code></p></li><li><p><code>Double.parseDouble(value)</code></p></li><li><p><code>Double.toString(value)</code></p></li></ul></div></section>
<section id="_autoboxing_unboxing"><h2>Autoboxing &amp; unboxing</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">Integer</span>&gt; list = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

<span class="comment">//autoboxing :-)</span>
list.add(<span class="integer">3</span>);
<span class="comment">//without autoboxing :-(</span>
list.add(<span class="predefined-type">Integer</span>.valueOf(<span class="integer">3</span>));

<span class="comment">//unboxing :-)</span>
<span class="type">int</span> n = list.get(i);
<span class="comment">//with no automatic unboxing :-(</span>
<span class="type">int</span> n = list.get(i).intValue();</code></pre></section>
<section id="_не_всегда_всё_так_очевидно_с_автобоксингом"><h2>Не всегда всё так очевидно с автобоксингом</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">Integer</span> n = <span class="integer">3</span>;
<span class="comment">//unbox - increment - box.</span>
<span class="comment">//not so effective!!</span>
n++;

<span class="predefined-type">Integer</span> a = <span class="integer">1000</span>;
<span class="predefined-type">Integer</span> b = <span class="integer">1000</span>;
<span class="keyword">if</span> (a == b) . . . <span class="comment">//NO! THIS WILL FAIL!</span></code></pre></section>
<section id="_класс_biginteger"><h2>Класс <code>BigInteger</code></h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">BigInteger</span> i = <span class="keyword">new</span> <span class="predefined-type">BigInteger</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">123456789012345678901234567890</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">BigInteger</span> j = <span class="keyword">new</span> <span class="predefined-type">BigInteger</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">123456789012345678901234567892</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">BigInteger</span> sum = i.add(j);
<span class="predefined-type">BigInteger</span> difference = i.subtract(j);
<span class="predefined-type">BigInteger</span> quotient = i.divide(j);
<span class="predefined-type">BigInteger</span> product = i.multiply(j);</code></pre></section>
<section id="_класс_bigdecimal"><h2>Класс <code>BigDecimal</code></h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">BigDecimal</span> calculateTotalAmount(
      <span class="predefined-type">BigDecimal</span> quantity,     <span class="predefined-type">BigDecimal</span> unitPrice,
      <span class="predefined-type">BigDecimal</span> discountRate, <span class="predefined-type">BigDecimal</span> taxRate) {
    <span class="predefined-type">BigDecimal</span> amount = quantity.multiply(unitPrice);
    <span class="predefined-type">BigDecimal</span> discount = amount.multiply(discountRate);
    <span class="predefined-type">BigDecimal</span> discountedAmount = amount.subtract(discount);
    <span class="predefined-type">BigDecimal</span> tax = discountedAmount.multiply(taxRate);
    <span class="predefined-type">BigDecimal</span> total = discountedAmount.add(tax);

    <span class="comment">// round to 2 decimal places using HALF_EVEN</span>
    <span class="predefined-type">BigDecimal</span> roundedTotal = total.setScale(<span class="integer">2</span>, <span class="predefined-type">RoundingMode</span>.HALF_EVEN);
    <span class="keyword">return</span> roundedTotal;
}</code></pre></section>
<section id="_полный_зоопарк_классов_ввода_вывода"><h2>Полный зоопарк классов ввода-вывода</h2><div class="imageblock" style=""><img src="images/input-output.jpg" alt="input output" /></div><div class="title">Cay Horstmann. Core Java, vol. II</div></section>
<section id="_классы_для_ввода_вывода_текста"><h2>Классы для ввода-вывода текста</h2><div class="imageblock" style=""><img src="images/reader-writer.jpg" alt="reader writer" /></div><div class="title">Cay Horstmann. Core Java, vol. II</div></section>
<section id="_базовые_потоки_вводавывода"><h2>Базовые потоки ввода/вывода</h2><div class="imageblock" style=""><img src="images/iostreams.png" alt="iostreams" /></div></section>
<section id="_комбинирование_потоков"><h2>Комбинирование потоков</h2><div class="imageblock" style=""><img src="images/combining.png" alt="combining" /></div>
<pre class="CodeRay listingblock"><code class="java language-java">Path path = Paths.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/file.dat</span><span class="delimiter">&quot;</span></span>);

<span class="keyword">try</span> (<span class="predefined-type">DataInputStream</span> dis =
         <span class="keyword">new</span> <span class="predefined-type">DataInputStream</span>(
             <span class="keyword">new</span> <span class="predefined-type">BufferedInputStream</span>(
                 Files.newInputStream(path)))) {
    <span class="type">double</span> doubleVal = dis.readDouble();
    <span class="type">long</span> longVal = dis.readLong();
}</code></pre></section>
<section id="_комбинирование_потоков_чтение_zip_файла"><h2>Комбинирование потоков: чтение Zip-файла</h2><pre class="CodeRay listingblock"><code class="java language-java">Path path = Paths.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/file.zip</span><span class="delimiter">&quot;</span></span>);

<span class="keyword">try</span>(<span class="predefined-type">ZipInputStream</span> zis =  <span class="keyword">new</span> <span class="predefined-type">ZipInputStream</span>(
    Files.newInputStream(path));
    <span class="predefined-type">DataInputStream</span> dis = <span class="keyword">new</span> <span class="predefined-type">DataInputStream</span>(zis)) {
    . . .
}</code></pre></section>
<section id="_чтениезапись_текстовых_данных"><h2>Чтение/запись текстовых данных</h2><div class="paragraph"><p>Современный, простой и правильный метод:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java">Path path = Paths.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/file.txt</span><span class="delimiter">&quot;</span></span>);

<span class="comment">//Ленивая вычитка</span>
Stream&lt;<span class="predefined-type">String</span>&gt; lines = Files.lines(path, StandardCharsets.UTF_8);

<span class="comment">//Вычитка всего содержимого в память</span>
<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; strings =
  Files.readAllLines(path, StandardCharsets.UTF_8);</code></pre></section>
<section id="_использование_bufferedreader"><h2>Использование BufferedReader</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="keyword">try</span> (<span class="predefined-type">BufferedReader</span> br =
     Files.newBufferedReader(path, StandardCharsets.UTF_8)){
    <span class="predefined-type">String</span> line;
    <span class="keyword">while</span> ((line = br.readLine())!=<span class="predefined-constant">null</span>){
           . . .
    }
}</code></pre></section>
<section id="_сохранение_готовых_данных_в_текст"><h2>Сохранение готовых данных в текст</h2><pre class="CodeRay listingblock"><code class="java language-java">Path path = Paths.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/file.txt</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; lines = <span class="keyword">new</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt;();
lines.add(...)

<span class="comment">//Если всё уже готово в памяти</span>
Files.write(path, lines, StandardCharsets.UTF_8);</code></pre></section>
<section id="_сохранение_данных_в_текст_по_мере_поступления"><h2>Сохранение данных в текст по мере поступления</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="keyword">try</span> (<span class="predefined-type">PrintWriter</span> printWriter = <span class="keyword">new</span> <span class="predefined-type">PrintWriter</span>(
                Files.newBufferedWriter(
                  path, StandardCharsets.UTF_8))) {
            printWriter.println(...);
            printWriter.printf(...);
        }</code></pre></section>
<section id="_работа_с_файловой_системой"><h2>Работа с файловой системой</h2><div class="ulist"><ul><li><p>Устаревший <code>File</code> (ещё может встретиться, в частности, как аргумент конструктора <code>FileInputStream</code>.</p></li><li><p>Более современный <code>Path</code> (Java 7+)</p></li></ul></div></section>
<section id="_работа_с_файловой_системой_2"><h2>Работа с файловой системой</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="comment">//Path не обязательно указывает</span>
<span class="comment">//на уже существующий файл или каталог!!</span>

Path absolute = Paths.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/home</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">harry</span><span class="delimiter">&quot;</span></span>);
Path relative = Paths.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">myprog</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">conf</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">user.properties</span><span class="delimiter">&quot;</span></span>);

Path subPath = absolute.resolve(<span class="string"><span class="delimiter">&quot;</span><span class="content">file.txt</span><span class="delimiter">&quot;</span></span>);

subPath.getParent(); <span class="comment">//родитель</span>
subPath.getFileName(); <span class="comment">//последняя компонента пути</span></code></pre></section>
<section id="_работа_с_файловой_системой_3"><h2>Работа с файловой системой</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="comment">//все компоненты, кроме последней, должны существовать</span>
Files.createDirectory(path);
<span class="comment">//создаёт все директории в path</span>
Files.createDirectories(path);
<span class="comment">//создаёт пустой файл</span>
Files.createFile(path);

<span class="comment">//создаёт временный файл в локации, специфичной для ОС</span>
Files.createTempFile(prefix, suffix);</code></pre></section>
<section id="_проверка_файлов"><h2>Проверка файлов</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="comment">//имеет смысл проверять перед тем, как открывать поток на чтение</span>
Files.exists(path)
Files.isReadable(path)

Files.size(path)</code></pre></section>
<section id="_чтение_списка_файлов_и_обход_директории_в_глубину"><h2>Чтение списка файлов и обход директории в глубину</h2><pre class="CodeRay listingblock"><code class="java language-java">Stream&lt;Path&gt; list = Files.list(path);

Stream&lt;Path&gt; walk(Path start,
   <span class="type">int</span> maxDepth, FileVisitOption... options)</code></pre></section>
<section id="_копирование_перемещение_и_удаление_файлов"><h2>Копирование, перемещение и удаление файлов</h2><pre class="CodeRay listingblock"><code class="java language-java">Files.copy(fromPath, toPath)

Files.move(fromPath, toPath)

Files.delete(path)</code></pre></section>
<section id="_часы_и_api_для_работы_со_временем"><h2>Часы и API для работы со временем</h2><div class="paragraph"><p><strong>Сколько секунд в сутках?</strong></p></div>
<div class="imageblock" style=""><img src="images/persistenceofmemory.jpg" alt="persistenceofmemory" width="60%" /></div></section>
<section id="_системные_часы"><h2>Системные часы</h2><div class="ulist"><ul><li class="fragment"><p><code>long System.currentTimeMillis()</code>&#8201;&#8212;&#8201;количество миллисекунд, прошедшее с наступления полуночи 1 января 1970 года на Гринвичском меридиане <em>минус число високосных секунд</em>, с точки зрения системных часов.</p><div class="ulist"><ul><li><p>Гранулярность может быть больше  миллисекунды.</p></li><li><p>"Замирают" при вставке високосной секунды.</p></li><li><p>Значения могут "скакать" <em>в обе</em> стороны при синхронизации через NTP!</p></li></ul></div></li><li class="fragment"><p><code>long System.nanoTime()</code>&#8201;&#8212;&#8201;монотонные часы.</p><div class="ulist"><ul><li><p>Наносекундная точность.</p></li><li><p>Нет привязки к "календарному" времени.</p></li></ul></div></li></ul></div></section>
<section id="_когда_что_использовать"><h2>Когда что использовать?</h2><div class="ulist"><ul><li><p><code>long System.nanoTime()</code>&#8201;&#8212;&#8201;при замерах периодов времени.</p><div class="ulist"><ul><li><p><em>Но для замеров производительности программ на Java надо применять JMH.</em></p></li></ul></div></li><li><p><code>long System.currentTimeMillis()</code>&#8201;&#8212;&#8201;для генерации штампов времени (с пониманием ограничений).</p></li></ul></div></section>
<section id="_datetime_api"><h2>DateTime API</h2><div class="ulist"><ul><li class="fragment"><p>Устаревшие, неудобные, мутабельные, непотокобезопасные классы (<em>не используйте их</em>):</p><div class="ulist"><ul><li><p>Java 1.0 <code>Date</code> (он всё ещё с нами из-за JDBC),</p></li><li><p>Java 1.1 <code>Calendar</code>.</p></li><li><p>С ними работает <code>DateFormat</code>.</p></li></ul></div></li><li class="fragment"><p>Современные (Java 8+), иммутабельные, разработанные с учётом набитых шишек классы:</p><div class="ulist"><ul><li><p><code>LocalDate</code>, <code>LocalTime</code>, <code>Instant</code>, <code>Duration</code>, <code>Period</code></p></li><li><p><code>ZoneId</code>, <code>ZonedDateTime</code>.</p></li><li><p>С ними работает <code>DateTimeFormatter</code>.</p></li></ul></div></li></ul></div></section>
<section id="_instant"><h2><code>Instant</code></h2><div class="ulist"><ul><li><p>Точка на временной прямой</p></li><li><p>UNIX time</p></li></ul></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="comment">//текущий момент</span>
Instant.now();
<span class="comment">//явно заданный Instant</span>
Instant.ofEpochSecond(<span class="integer">3</span>);
<span class="comment">//Какой сегодня год?</span>
<span class="type">int</span> year = Instant.now().get(ChronoField.YEAR);</code></pre></section>
<section id="_localdate_localtime_и_localdatetime"><h2><code>LocalDate</code>, <code>LocalTime</code> и <code>LocalDateTime</code></h2><div class="ulist"><ul><li><p>Дата и время в "человеческом" понимании.</p></li><li><p>Без информации о том, в каком часовом поясе &#8594; без привязки к <code>Instant</code>.</p></li><li><p>Часто такая привязка не нужна: "еженедельный митинг в 9:00" в привязке к UTC "уползёт" при переходе на летнее время.</p></li></ul></div>
<pre class="CodeRay listingblock"><code class="java language-java">LocalDate date = LocalDate.of(<span class="integer">2014</span>, <span class="integer">3</span>, <span class="integer">18</span>); <span class="comment">//18 марта 2014 г</span>

<span class="type">int</span> year      = date.getYear(); <span class="comment">//2014</span>
Month month   = date.getMonth();  <span class="comment">//MARCH</span>
<span class="type">int</span> day       = date.getDayOfMonth(); <span class="comment">//18</span>
DayOfWeek dow = date.getDayOfWeek(); <span class="comment">//TUESDAY</span></code></pre></section>
<section id="_localtime_и_localdatetime"><h2><code>LocalTime</code> и <code>LocalDateTime</code></h2><pre class="CodeRay listingblock"><code class="java language-java">LocalTime time = LocalTime.of(<span class="integer">13</span>, <span class="integer">45</span>, <span class="integer">20</span>); <span class="comment">//13:45:20</span>

<span class="type">int</span> hour   = time.getHour();
<span class="type">int</span> minute = time.getMinute();
<span class="type">int</span> second = time.getSecond();

LocalDateTime dt1 = LocalDateTime.of(<span class="integer">2014</span>, Month.MARCH, <span class="integer">18</span>, <span class="integer">13</span>, <span class="integer">45</span>, <span class="integer">20</span>);
LocalDateTime dt1 = LocalDateTime.of(date, time);
LocalDateTime dt2 = date.atTime(time);
LocalDateTime dt3 = time.atDate(date);

dt1.toLocalDate(); <span class="comment">//2014-03-18</span>
dt1.toLocalTime(); <span class="comment">//13:45:20</span></code></pre></section>
<section id="_duration_и_period"><h2><code>Duration</code> и <code>Period</code></h2><div class="ulist"><ul><li><p><code>Duration</code>: количество времени между двумя точками на временной прямой с наносекундной точностью.</p></li><li><p><code>Period</code>: разица во времени между <code>LocalDate</code> в днях (например, "сколько дней действует договор?")</p></li><li><p>Оба реализуют интерфейс <code>TemporalAmount</code>.</p></li></ul></div>
<pre class="CodeRay listingblock"><code>//В качестве аргументов годятся LocalTime, LocalDateTime и Instant
Duration d = Duration.between(time1, time2);

//В качестве аргумента годится только LocalDate
Period tenDays = Period.between(
    LocalDate.of(2014, 3, 8),
    LocalDate.of(2014, 3, 18));</code></pre></section>
<section id="_конструирование_новых_объектов_из_старых"><h2>Конструирование новых объектов из старых</h2><pre class="CodeRay listingblock"><code class="java language-java">Instant i = Instant.now();
<span class="predefined-type">Duration</span> d = <span class="predefined-type">Duration</span>.ofSeconds(<span class="integer">3</span>);

<span class="comment">//например:</span>
i.plus(dd.multipliedBy(<span class="integer">10</span>))
 .minus(dd.minus(<span class="predefined-type">Duration</span>.ofMillis(<span class="integer">1</span>)));

<span class="comment">//то же самое можно сделать с LocalDateTime</span></code></pre></section>
<section id="_печать_и_парсинг_даты_времени"><h2>Печать и парсинг даты-времени</h2><pre class="CodeRay listingblock"><code class="java language-java">DateTimeFormatter formatter1 =
  DateTimeFormatter.ISO_LOCAL_DATE; <span class="comment">// YYY-MM-DD</span>
DateTimeFormatter formatter2 =
  DateTimeFormatter.ofPattern(<span class="string"><span class="delimiter">&quot;</span><span class="content">dd/MM/yyyy</span><span class="delimiter">&quot;</span></span>);
DateTimeFormatter formatter3 = <span class="keyword">new</span> DateTimeFormatterBuilder()
  .appendText(ChronoField.DAY_OF_MONTH)
  .appendLiteral(<span class="string"><span class="delimiter">&quot;</span><span class="content">. </span><span class="delimiter">&quot;</span></span>)
  .appendText(ChronoField.MONTH_OF_YEAR)
  .appendLiteral(<span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>)
  .appendText(ChronoField.YEAR)
  .parseCaseInsensitive()
  .toFormatter(<span class="predefined-type">Locale</span>.ITALIAN);</code></pre></section>
<section id="_в_строку_и_из_строки"><h2>В строку и из строки</h2><pre class="CodeRay listingblock"><code class="java language-java">LocalDate date = LocalDate.of(<span class="integer">2014</span>, <span class="integer">3</span>, <span class="integer">18</span>);
<span class="predefined-type">String</span> s = date.format(
  DateTimeFormatter.ISO_LOCAL_DATE); <span class="comment">// 2014-03-18</span>
LocalDate date2 = LocalDate.parse(
  s, DateTimeFormatter.ISO_LOCAL_DATE);</code></pre></section>
<section id="_часовые_пояса"><h2>Часовые пояса</h2><pre class="CodeRay listingblock"><code class="java language-java">ZoneId moscowZone = ZoneId.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">Europe/Moscow</span><span class="delimiter">&quot;</span></span>);
ZoneId romeZone = ZoneId.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">Europe/Rome</span><span class="delimiter">&quot;</span></span>);
LocalDateTime dateTime = LocalDateTime.now();

ZonedDateTime moscowTime = dateTime.atZone(moscowZone);
<span class="predefined-type">System</span>.out.println(moscowTime);
<span class="comment">//2019-09-30T18:15:52.670+03:00[Europe/Moscow]</span>

ZonedDateTime romeTime =
  moscowTime.withZoneSameInstant(romeZone);
<span class="predefined-type">System</span>.out.println(romeTime);
<span class="comment">//2019-09-30T17:15:52.670+02:00[Europe/Rome]</span></code></pre></section></div></div><script src="reveal.js-3.7.0/lib/js/head.min.js"></script><script src="reveal.js-3.7.0/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
})

// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: true,
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: false,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'none',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1600,
  height: 900,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js-3.7.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      
      { src: 'reveal.js-3.7.0/plugin/zoom-js/zoom.js', async: true },
      { src: 'reveal.js-3.7.0/plugin/notes/notes.js', async: true },
      
      
      
      
  ],

  

});</script></body></html>